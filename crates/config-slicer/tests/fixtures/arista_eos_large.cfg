! Command: show running-config
! device: SPINE-SW-01 (DCS-7280SR-48C6, EOS-4.28.3M)
!
! boot system flash:/EOS-4.28.3M.swi
!
hostname SPINE-SW-01
!
username admin privilege 15 role network-admin secret sha512 $6$abcdefghijklmnop$1234567890abcdef...
username operator privilege 1 role network-operator secret sha512 $6$qrstuvwxyz123456$fedcba0987654321...
!
daemon TerminAttr
   exec /usr/bin/TerminAttr -cvaddr=192.168.50.10:9910 -cvauth=token,/tmp/token -cvvrf=management -smashexcludes=ale,flexCounter,hardware,kni,pulse,strata -ingestexclude=/Sysdb/cell/1/agent,/Sysdb/cell/2/agent -taillogs
   no shutdown
!
vrf instance management
   description Management VRF
!
vrf instance tenant-a
   rd 65001:1000
   route-target import evpn 65001:1000
   route-target export evpn 65001:1000
!
vrf instance tenant-b
   rd 65001:2000
   route-target import evpn 65001:2000
   route-target export evpn 65001:2000
!
vrf instance tenant-c
   rd 65001:3000
   route-target import evpn 65001:3000
   route-target export evpn 65001:3000
!
transceiver qsfp default-mode 4x10G
!
service routing protocols model multi-agent
!
hostname SPINE-SW-01
ip name-server vrf management 8.8.8.8
ip name-server vrf management 8.8.4.4
ip name-server vrf management 192.168.50.10
!
spanning-tree mode mstp
spanning-tree mst 0 priority 4096
!
no enable password
no aaa root
!
username admin privilege 15 role network-admin secret sha512 $6$7u4j1rkw3VELgcZE$djXVjUnxBjXKnofpPiIpBU8iTJO/DvpHTNBqJJSgFVb1J3jjCXbVDVh0tq8Lj7M9F1qUpHbr3UpWqaqQ5zF5X0
username cvpadmin privilege 15 role network-admin secret sha512 $6$wfqPFEJ4/PqOJHUH$bNBBN5ZgPVVE8wZFgD8GkTQ2ZtQfZeA0kZH2QjO8IkJCF7I4UcLqFGD5E2BzMvFr8u5jvB4WdT2WcmWv1hG5F/
!
vlan internal order ascending range 1006 1199
!
vlan 10
   name management
!
vlan 20
   name guest
!
vlan 30
   name voice
!
vlan 40
   name data
!
vlan 50
   name servers
!
vlan 100
   name tenant-a-web
!
vlan 101
   name tenant-a-app
!
vlan 102
   name tenant-a-db
!
vlan 200
   name tenant-b-web
!
vlan 201
   name tenant-b-app
!
vlan 202
   name tenant-b-db
!
vlan 300
   name tenant-c-web
!
vlan 301
   name tenant-c-app
!
vlan 302
   name tenant-c-db
!
vlan 4000
   name mlag-peer-link
!
vrf instance management
!
interface Port-Channel1
   description MLAG Peer Link to SPINE-SW-02
   no shutdown
   switchport
   switchport mode trunk
   switchport trunk group mlag-peer
   switchport trunk group peer-link
!
interface Port-Channel10
   description Connection to LEAF-SW-01-02
   no shutdown
   switchport
   switchport mode trunk
   switchport trunk allowed vlan 10,20,30,40,50,100-102,200-202,300-302
   mlag 10
!
interface Port-Channel11
   description Connection to LEAF-SW-03-04
   no shutdown
   switchport
   switchport mode trunk
   switchport trunk allowed vlan 10,20,30,40,50,100-102,200-202,300-302
   mlag 11
!
interface Port-Channel12
   description Connection to LEAF-SW-05-06
   no shutdown
   switchport
   switchport mode trunk
   switchport trunk allowed vlan 10,20,30,40,50,100-102,200-202,300-302
   mlag 12
!
interface Ethernet1
   description MLAG Peer Link Member to SPINE-SW-02
   no shutdown
   channel-group 1 mode active
!
interface Ethernet2
   description MLAG Peer Link Member to SPINE-SW-02
   no shutdown
   channel-group 1 mode active
!
interface Ethernet3/1
   description Connection to LEAF-SW-01
   no shutdown
   channel-group 10 mode active
!
interface Ethernet3/2
   description Connection to LEAF-SW-02
   no shutdown
   channel-group 10 mode active
!
interface Ethernet4/1
   description Connection to LEAF-SW-03
   no shutdown
   channel-group 11 mode active
!
interface Ethernet4/2
   description Connection to LEAF-SW-04
   no shutdown
   channel-group 11 mode active
!
interface Ethernet5/1
   description Connection to LEAF-SW-05
   no shutdown
   channel-group 12 mode active
!
interface Ethernet5/2
   description Connection to LEAF-SW-06
   no shutdown
   channel-group 12 mode active
!
interface Ethernet6/1
   description Connection to WAN Router
   no shutdown
   no switchport
   ip address 10.0.0.1/30
!
interface Ethernet6/2
   description Connection to Firewall
   no shutdown
   no switchport
   ip address 10.0.0.5/30
!
interface Ethernet49/1
   description 40G Uplink to Core Router
   no shutdown
   no switchport
   ip address 10.0.1.1/30
!
interface Ethernet50/1
   description 40G Uplink to Border Router
   no shutdown
   no switchport
   ip address 10.0.1.5/30
!
interface Loopback0
   description Router ID
   ip address 10.255.255.1/32
!
interface Loopback1
   description VTEP Source
   ip address 10.255.254.1/32
!
interface Management1
   description Management Interface
   vrf management
   ip address 192.168.50.21/24
!
interface Vlan10
   description management SVI
   vrf management
   ip address 192.168.10.1/24
   ip helper-address 192.168.50.10
!
interface Vlan20
   description guest SVI
   ip address 192.168.20.1/24
   ip helper-address 192.168.50.10
   ip access-group guest-acl in
!
interface Vlan30
   description voice SVI
   ip address 192.168.30.1/24
   ip helper-address 192.168.50.10
!
interface Vlan40
   description data SVI
   ip address 192.168.40.1/24
   ip helper-address 192.168.50.10
!
interface Vlan50
   description servers SVI
   ip address 192.168.50.1/24
!
interface Vlan100
   description tenant-a-web SVI
   vrf tenant-a
   ip address 172.16.100.1/24
   ip helper-address 172.16.254.10
!
interface Vlan101
   description tenant-a-app SVI
   vrf tenant-a
   ip address 172.16.101.1/24
   ip helper-address 172.16.254.10
!
interface Vlan102
   description tenant-a-db SVI
   vrf tenant-a
   ip address 172.16.102.1/24
   ip helper-address 172.16.254.10
!
interface Vlan200
   description tenant-b-web SVI
   vrf tenant-b
   ip address 172.17.100.1/24
   ip helper-address 172.17.254.10
!
interface Vlan201
   description tenant-b-app SVI
   vrf tenant-b
   ip address 172.17.101.1/24
   ip helper-address 172.17.254.10
!
interface Vlan202
   description tenant-b-db SVI
   vrf tenant-b
   ip address 172.17.102.1/24
   ip helper-address 172.17.254.10
!
interface Vlan300
   description tenant-c-web SVI
   vrf tenant-c
   ip address 172.18.100.1/24
   ip helper-address 172.18.254.10
!
interface Vlan301
   description tenant-c-app SVI
   vrf tenant-c
   ip address 172.18.101.1/24
   ip helper-address 172.18.254.10
!
interface Vlan302
   description tenant-c-db SVI
   vrf tenant-c
   ip address 172.18.102.1/24
   ip helper-address 172.18.254.10
!
interface Vlan4000
   description MLAG Peer Communication
   ip address 10.255.253.1/30
!
interface Vxlan1
   vxlan source-interface Loopback1
   vxlan udp-port 4789
   vxlan vlan 100 vni 10100
   vxlan vlan 101 vni 10101
   vxlan vlan 102 vni 10102
   vxlan vlan 200 vni 10200
   vxlan vlan 201 vni 10201
   vxlan vlan 202 vni 10202
   vxlan vlan 300 vni 10300
   vxlan vlan 301 vni 10301
   vxlan vlan 302 vni 10302
   vxlan vrf tenant-a vni 50001
   vxlan vrf tenant-b vni 50002
   vxlan vrf tenant-c vni 50003
!
ip virtual-router mac-address 00:1c:73:00:dc:01
!
ip route vrf management 0.0.0.0/0 192.168.50.1
ip route 0.0.0.0/0 10.0.1.2
!
ip routing
ip routing vrf management
ip routing vrf tenant-a
ip routing vrf tenant-b
ip routing vrf tenant-c
!
ip prefix-list PL-LOOPBACKS seq 10 permit 10.255.254.0/24 le 32
ip prefix-list PL-LOOPBACKS seq 20 permit 10.255.255.0/24 le 32
!
ip access-list guest-acl
   10 permit udp any any eq bootpc
   20 permit udp any any eq domain
   30 permit tcp any any eq domain
   40 permit tcp any any eq www
   50 permit tcp any any eq https
   60 permit tcp any any eq ntp
   70 deny ip any 192.168.10.0/24
   80 deny ip any 192.168.30.0/24
   90 deny ip any 192.168.40.0/24
   100 deny ip any 192.168.50.0/24
   110 deny ip any 172.16.0.0/12
   120 deny ip any 10.0.0.0/8
   130 permit ip any any
!
mlag configuration
   domain-id mlag-domain
   local-interface Vlan4000
   peer-address 10.255.253.2
   peer-link Port-Channel1
   reload-delay mlag 300
   reload-delay non-mlag 330
!
route-map RM-CONN-2-BGP permit 10
   match ip address prefix-list PL-LOOPBACKS
!
route-map RM-MLAG-PEER-IN permit 10
   description Make MLAG peer paths less preferred
   set local-preference 50
!
router bgp 65001
   router-id 10.255.255.1
   maximum-paths 4 ecmp 4
   neighbor EVPN-OVERLAY-PEERS peer group
   neighbor EVPN-OVERLAY-PEERS remote-as 65001
   neighbor EVPN-OVERLAY-PEERS update-source Loopback0
   neighbor EVPN-OVERLAY-PEERS bfd
   neighbor EVPN-OVERLAY-PEERS ebgp-multihop 3
   neighbor EVPN-OVERLAY-PEERS password 7 $1c$G8BQN0ezkRJmKNICEAGQ6g==
   neighbor EVPN-OVERLAY-PEERS send-community
   neighbor EVPN-OVERLAY-PEERS maximum-routes 0
   neighbor IPv4-UNDERLAY-PEERS peer group
   neighbor IPv4-UNDERLAY-PEERS remote-as 65001
   neighbor IPv4-UNDERLAY-PEERS password 7 $1c$G8BQN0ezkRJmKNICEAGQ6g==
   neighbor IPv4-UNDERLAY-PEERS send-community
   neighbor IPv4-UNDERLAY-PEERS maximum-routes 12000
   neighbor MLAG-IPv4-UNDERLAY-PEER peer group
   neighbor MLAG-IPv4-UNDERLAY-PEER remote-as 65001
   neighbor MLAG-IPv4-UNDERLAY-PEER next-hop-self
   neighbor MLAG-IPv4-UNDERLAY-PEER password 7 $1c$G8BQN0ezkRJmKNICEAGQ6g==
   neighbor MLAG-IPv4-UNDERLAY-PEER send-community
   neighbor MLAG-IPv4-UNDERLAY-PEER maximum-routes 12000
   neighbor MLAG-IPv4-UNDERLAY-PEER route-map RM-MLAG-PEER-IN in
   neighbor 10.0.1.2 peer group IPv4-UNDERLAY-PEERS
   neighbor 10.0.1.2 description CORE-RT-01
   neighbor 10.0.1.6 peer group IPv4-UNDERLAY-PEERS
   neighbor 10.0.1.6 description BORDER-RT-01
   neighbor 10.255.253.2 peer group MLAG-IPv4-UNDERLAY-PEER
   neighbor 10.255.253.2 description SPINE-SW-02
   neighbor 10.255.255.2 peer group EVPN-OVERLAY-PEERS
   neighbor 10.255.255.2 description SPINE-SW-02
   neighbor 10.255.255.11 peer group EVPN-OVERLAY-PEERS
   neighbor 10.255.255.11 description LEAF-SW-01
   neighbor 10.255.255.12 peer group EVPN-OVERLAY-PEERS
   neighbor 10.255.255.12 description LEAF-SW-02
   neighbor 10.255.255.13 peer group EVPN-OVERLAY-PEERS
   neighbor 10.255.255.13 description LEAF-SW-03
   neighbor 10.255.255.14 peer group EVPN-OVERLAY-PEERS
   neighbor 10.255.255.14 description LEAF-SW-04
   neighbor 10.255.255.15 peer group EVPN-OVERLAY-PEERS
   neighbor 10.255.255.15 description LEAF-SW-05
   neighbor 10.255.255.16 peer group EVPN-OVERLAY-PEERS
   neighbor 10.255.255.16 description LEAF-SW-06
   redistribute connected route-map RM-CONN-2-BGP
   !
   vlan-aware-bundle tenant-a
      rd 10.255.255.1:1000
      route-target both 1000:1000
      redistribute learned
      vlan 100-102
   !
   vlan-aware-bundle tenant-b
      rd 10.255.255.1:2000
      route-target both 2000:2000
      redistribute learned
      vlan 200-202
   !
   vlan-aware-bundle tenant-c
      rd 10.255.255.1:3000
      route-target both 3000:3000
      redistribute learned
      vlan 300-302
   !
   address-family evpn
      neighbor EVPN-OVERLAY-PEERS activate
   !
   address-family ipv4
      no neighbor EVPN-OVERLAY-PEERS activate
      neighbor IPv4-UNDERLAY-PEERS activate
      neighbor MLAG-IPv4-UNDERLAY-PEER activate
   !
   vrf tenant-a
      rd 10.255.255.1:1000
      route-target import evpn 1000:1000
      route-target export evpn 1000:1000
      router-id 10.255.255.1
      redistribute connected
   !
   vrf tenant-b
      rd 10.255.255.1:2000
      route-target import evpn 2000:2000
      route-target export evpn 2000:2000
      router-id 10.255.255.1
      redistribute connected
   !
   vrf tenant-c
      rd 10.255.255.1:3000
      route-target import evpn 3000:3000
      route-target export evpn 3000:3000
      router-id 10.255.255.1
      redistribute connected
!
router ospf 1
   router-id 10.255.255.1
   passive-interface default
   no passive-interface Ethernet6/1
   no passive-interface Ethernet6/2
   no passive-interface Ethernet49/1
   no passive-interface Ethernet50/1
   max-lsa 12000
   network 10.0.0.0/30 area 0.0.0.0
   network 10.0.0.4/30 area 0.0.0.0
   network 10.0.1.0/30 area 0.0.0.0
   network 10.0.1.4/30 area 0.0.0.0
   network 10.255.255.1/32 area 0.0.0.0
!
management api http-commands
   protocol http
   no shutdown
   !
   vrf management
      no shutdown
!
management api gnmi
   transport grpc default
      vrf management
   provider eos-native
!
management api netconf
   transport ssh default
      vrf management
!
management cvx
   no shutdown
   server host 192.168.50.10
   source-interface vrf management Management1
!
end