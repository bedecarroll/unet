## Last commit: 2024-01-15 10:30:00 PST by admin
version 20.4R3.8;
system {
    host-name CORE-RT-01;
    domain-name example.com;
    domain-search [ example.com lab.example.com ];
    time-zone America/Los_Angeles;
    authentication-order [ radius password ];
    root-authentication {
        encrypted-password "$6$abcdef$xyz123...";
    }
    name-server {
        8.8.8.8;
        8.8.4.4;
        192.168.50.10;
    }
    radius-server {
        192.168.50.20 {
            port 1812;
            secret "$9$abcdef123...";
            retry 3;
            timeout 10;
            source-address 192.168.1.1;
        }
        192.168.50.21 {
            port 1812;
            secret "$9$xyz789...";
            retry 3;
            timeout 10;
            source-address 192.168.1.1;
        }
    }
    login {
        class super-user-local {
            idle-timeout 60;
            permissions all;
        }
        class operator {
            idle-timeout 30;
            permissions [ view view-configuration ];
        }
        class read-only {
            idle-timeout 15;
            permissions [ view ];
        }
        user admin {
            uid 2000;
            class super-user-local;
            authentication {
                encrypted-password "$6$ghijkl$abc789...";
            }
        }
        user operator {
            uid 2001;
            class operator;
            authentication {
                encrypted-password "$6$mnopqr$def456...";
            }
        }
        user readonly {
            uid 2002;
            class read-only;
            authentication {
                encrypted-password "$6$stuvwx$ghi123...";
            }
        }
    }
    services {
        ssh {
            root-login deny;
            protocol-version v2;
            rate-limit 10;
            connection-limit 20;
            client-alive-count-max 3;
            client-alive-interval 60;
        }
        netconf {
            ssh {
                port 830;
                connection-limit 10;
            }
        }
        web-management {
            https {
                port 9443;
                system-generated-certificate;
                interface [ ge-0/0/0.0 lo0.0 ];
            }
        }
    }
    syslog {
        archive size 10m files 10 world-readable;
        user * {
            any emergency;
        }
        host 192.168.50.10 {
            any info;
            port 514;
            facility-override local7;
        }
        host 192.168.50.11 {
            any info;
            port 514;
            facility-override local7;
        }
        file messages {
            any notice;
            authorization info;
        }
        file interactive-commands {
            interactive-commands any;
        }
        file security {
            authorization any;
            change-log any;
            interactive-commands any;
        }
    }
    max-configurations-on-flash 49;
    max-configuration-rollbacks 49;
    license {
        autoupdate {
            url https://ae1.juniper.net/junos/key_retrieval;
        }
    }
    ntp {
        boot-server 192.168.50.10;
        server 192.168.50.10 prefer;
        server 192.168.50.11;
        server pool.ntp.org;
        source-address 192.168.1.1;
    }
}
chassis {
    redundancy {
        graceful-switchover;
    }
    aggregated-devices {
        ethernet {
            device-count 8;
        }
    }
    alarm {
        management-ethernet {
            link-down ignore;
        }
    }
}
interfaces {
    ge-0/0/0 {
        description "Uplink to ISP Provider";
        unit 0 {
            family inet {
                dhcp {
                    vendor-id Juniper-mx960-CORE-RT-01;
                }
            }
        }
    }
    ge-0/0/1 {
        description "Connection to CORE-RT-02";
        unit 0 {
            family inet {
                address 10.0.1.1/30;
            }
            family mpls;
        }
    }
    ge-0/0/2 {
        description "Connection to EDGE-RT-01";
        unit 0 {
            family inet {
                address 10.0.1.5/30;
            }
            family mpls;
        }
    }
    ge-0/0/3 {
        description "Connection to EDGE-RT-02";
        unit 0 {
            family inet {
                address 10.0.1.9/30;
            }
            family mpls;
        }
    }
    ge-0/0/4 {
        description "Management Network Connection";
        unit 0 {
            family inet {
                address 192.168.10.1/24;
            }
        }
    }
    ge-0/0/5 {
        description "Server Network Connection";
        unit 0 {
            family inet {
                address 192.168.50.1/24;
            }
        }
    }
    ge-0/0/6 {
        description "Guest Network Connection";
        unit 0 {
            family inet {
                address 192.168.20.1/24;
            }
        }
    }
    ge-0/0/7 {
        description "Voice Network Connection";
        unit 0 {
            family inet {
                address 192.168.30.1/24;
            }
        }
    }
    ge-0/0/8 {
        description "Data Network Connection";
        unit 0 {
            family inet {
                address 192.168.40.1/24;
            }
        }
    }
    ae0 {
        description "LAG to Distribution Switch";
        aggregated-ether-options {
            minimum-links 1;
            link-speed 1g;
            lacp {
                active;
                periodic fast;
            }
        }
        unit 0 {
            family inet {
                address 10.0.2.1/30;
            }
        }
    }
    ae1 {
        description "LAG to Access Switch Farm";
        aggregated-ether-options {
            minimum-links 2;
            link-speed 1g;
            lacp {
                active;
                periodic fast;
            }
        }
        unit 0 {
            family inet {
                address 10.0.2.5/30;
            }
        }
    }
    lo0 {
        description "Loopback Interface";
        unit 0 {
            family inet {
                address 192.168.1.1/32;
                address 10.0.0.1/32;
            }
        }
    }
    irb {
        description "Integrated Routing and Bridging";
        unit 100 {
            family inet {
                address 172.16.100.1/24;
            }
        }
        unit 200 {
            family inet {
                address 172.16.200.1/24;
            }
        }
    }
}
snmp {
    description "CORE-RT-01 - Main Core Router";
    location "Data Center - Rack 1 - Position 10";
    contact "Network Operations <netops@example.com>";
    community public {
        authorization read-only;
        clients {
            192.168.50.0/24;
            192.168.10.0/24;
        }
    }
    community private {
        authorization read-write;
        clients {
            192.168.50.10/32;
            192.168.50.11/32;
        }
    }
    trap-options {
        source-address 192.168.1.1;
    }
    trap-group monitoring {
        version v2;
        categories {
            chassis;
            link;
            routing;
            startup;
            vrrp;
        }
        targets {
            192.168.50.10;
            192.168.50.11;
        }
    }
}
forwarding-options {
    storm-control-profiles {
        default {
            all {
                bandwidth-level 80;
                burst-size 80;
                no-broadcast;
                no-multicast;
                no-unknown-unicast;
            }
        }
    }
    hash-key {
        family inet {
            layer-3;
            layer-4;
        }
    }
}
routing-engine {
    backup-router 192.168.1.2;
}
routing-options {
    static {
        route 0.0.0.0/0 next-hop 192.168.1.254;
        route 169.254.0.0/16 reject;
        route 224.0.0.0/4 reject;
    }
    router-id 10.0.0.1;
    autonomous-system 65001;
    aggregate {
        route 192.168.0.0/16 {
            policy aggregate-contributors;
        }
        route 10.0.0.0/8 {
            policy aggregate-contributors;
        }
    }
    forwarding-table {
        export load-balance-policy;
        ecmp-fast-reroute;
    }
}
protocols {
    ospf {
        reference-bandwidth 100g;
        area 0.0.0.0 {
            interface ge-0/0/1.0 {
                interface-type p2p;
                hello-interval 10;
                dead-interval 40;
                metric 100;
            }
            interface ge-0/0/2.0 {
                interface-type p2p;
                hello-interval 10;
                dead-interval 40;
                metric 100;
            }
            interface ge-0/0/3.0 {
                interface-type p2p;
                hello-interval 10;
                dead-interval 40;
                metric 100;
            }
            interface ge-0/0/4.0 {
                passive;
                metric 10;
            }
            interface ge-0/0/5.0 {
                passive;
                metric 10;
            }
            interface lo0.0 {
                passive;
            }
            interface ae0.0 {
                interface-type p2p;
                hello-interval 10;
                dead-interval 40;
                metric 50;
            }
            interface ae1.0 {
                interface-type p2p;
                hello-interval 10;
                dead-interval 40;
                metric 50;
            }
        }
        area 0.0.0.1 {
            interface ge-0/0/6.0 {
                passive;
                metric 20;
            }
            interface ge-0/0/7.0 {
                passive;
                metric 20;
            }
            interface ge-0/0/8.0 {
                passive;
                metric 20;
            }
        }
    }
    bgp {
        group ibgp {
            type internal;
            local-address 10.0.0.1;
            family inet {
                unicast;
            }
            export bgp-export-policy;
            neighbor 10.0.0.2 {
                description "CORE-RT-02";
            }
            neighbor 10.0.0.3 {
                description "EDGE-RT-01";
            }
            neighbor 10.0.0.4 {
                description "EDGE-RT-02";
            }
        }
        group ebgp {
            type external;
            multihop {
                ttl 2;
            }
            family inet {
                unicast;
            }
            export bgp-export-policy;
            neighbor 203.0.113.1 {
                description "ISP Provider A";
                peer-as 65100;
                local-as 65001;
                import isp-import-policy;
                export isp-export-policy;
            }
            neighbor 203.0.113.5 {
                description "ISP Provider B";
                peer-as 65200;
                local-as 65001;
                import isp-import-policy;
                export isp-export-policy;
            }
        }
    }
    lldp {
        port-id-subtype interface-name;
        port-description-type interface-description;
        interface all;
    }
    lldp-med {
        interface all;
    }
    igmp-snooping {
        vlan all;
    }
    rstp {
        bridge-priority 8k;
        interface all {
            edge;
            no-root-port;
        }
    }
}
policy-options {
    prefix-list internal-networks {
        192.168.0.0/16;
        10.0.0.0/8;
        172.16.0.0/12;
    }
    prefix-list bogon-prefixes {
        0.0.0.0/8;
        10.0.0.0/8;
        127.0.0.0/8;
        169.254.0.0/16;
        172.16.0.0/12;
        192.0.0.0/24;
        192.0.2.0/24;
        192.88.99.0/24;
        192.168.0.0/16;
        198.18.0.0/15;
        198.51.100.0/24;
        203.0.113.0/24;
        224.0.0.0/4;
        240.0.0.0/4;
    }
    policy-statement aggregate-contributors {
        term 1 {
            from {
                protocol direct;
                route-filter 192.168.0.0/16 orlonger;
            }
            then accept;
        }
        term 2 {
            from {
                protocol ospf;
                route-filter 10.0.0.0/8 orlonger;
            }
            then accept;
        }
        term default {
            then reject;
        }
    }
    policy-statement bgp-export-policy {
        term aggregates {
            from {
                protocol aggregate;
            }
            then {
                community add internal-routes;
                accept;
            }
        }
        term direct {
            from {
                protocol direct;
                prefix-list internal-networks;
            }
            then {
                community add internal-routes;
                accept;
            }
        }
        term ospf {
            from {
                protocol ospf;
                prefix-list internal-networks;
            }
            then {
                community add internal-routes;
                accept;
            }
        }
        term default {
            then reject;
        }
    }
    policy-statement isp-import-policy {
        term reject-bogons {
            from {
                prefix-list bogon-prefixes;
            }
            then reject;
        }
        term reject-long-prefixes {
            from {
                route-filter 0.0.0.0/0 prefix-length-range /25-/32;
            }
            then reject;
        }
        term accept-default {
            from {
                route-filter 0.0.0.0/0 exact;
            }
            then {
                local-preference 100;
                community add default-route;
                accept;
            }
        }
        term accept-others {
            then {
                local-preference 80;
                community add external-routes;
                accept;
            }
        }
    }
    policy-statement isp-export-policy {
        term export-internal {
            from {
                community internal-routes;
            }
            then {
                as-path-prepend "65001";
                accept;
            }
        }
        term default {
            then reject;
        }
    }
    policy-statement load-balance-policy {
        term 1 {
            then {
                load-balance per-packet;
            }
        }
    }
    community internal-routes members 65001:100;
    community external-routes members 65001:200;
    community default-route members 65001:300;
}
firewall {
    family inet {
        filter protect-routing-engine {
            term accept-ospf {
                from {
                    source-address {
                        10.0.1.0/30;
                        10.0.1.4/30;
                        10.0.1.8/30;
                    }
                    protocol ospf;
                }
                then accept;
            }
            term accept-bgp {
                from {
                    source-address {
                        10.0.0.0/24;
                        203.0.113.0/30;
                        203.0.113.4/30;
                    }
                    protocol tcp;
                    destination-port bgp;
                }
                then accept;
            }
            term accept-ssh {
                from {
                    source-address {
                        192.168.10.0/24;
                        192.168.50.0/24;
                    }
                    protocol tcp;
                    destination-port ssh;
                }
                then accept;
            }
            term accept-snmp {
                from {
                    source-address {
                        192.168.50.10/32;
                        192.168.50.11/32;
                    }
                    protocol udp;
                    destination-port snmp;
                }
                then accept;
            }
            term accept-ntp {
                from {
                    source-address {
                        192.168.50.10/32;
                        192.168.50.11/32;
                    }
                    protocol udp;
                    source-port ntp;
                }
                then accept;
            }
            term accept-dhcp {
                from {
                    source-address {
                        192.168.20.0/24;
                        192.168.30.0/24;
                        192.168.40.0/24;
                    }
                    protocol udp;
                    destination-port bootps;
                }
                then accept;
            }
            term accept-ping {
                from {
                    source-address {
                        192.168.0.0/16;
                        10.0.0.0/8;
                    }
                    protocol icmp;
                    icmp-type echo-request;
                }
                then accept;
            }
            term accept-traceroute {
                from {
                    source-address {
                        192.168.0.0/16;
                        10.0.0.0/8;
                    }
                    protocol udp;
                    destination-port 33434-33523;
                }
                then accept;
            }
            term default-deny {
                then {
                    log;
                    discard;
                }
            }
        }
        filter guest-network-filter {
            term allow-dhcp {
                from {
                    protocol udp;
                    destination-port bootps;
                }
                then accept;
            }
            term allow-dns {
                from {
                    protocol udp;
                    destination-port domain;
                }
                then accept;
            }
            term allow-http {
                from {
                    protocol tcp;
                    destination-port [ http https ];
                }
                then accept;
            }
            term deny-internal {
                from {
                    destination-address {
                        192.168.0.0/16;
                        10.0.0.0/8;
                        172.16.0.0/12;
                    }
                }
                then {
                    log;
                    discard;
                }
            }
            term allow-internet {
                then accept;
            }
        }
    }
}
vlans {
    management {
        vlan-id 10;
        l3-interface irb.10;
    }
    guest {
        vlan-id 20;
        l3-interface irb.20;
    }
    voice {
        vlan-id 30;
        l3-interface irb.30;
    }
    data {
        vlan-id 40;
        l3-interface irb.40;
    }
    servers {
        vlan-id 50;
        l3-interface irb.50;
    }
}